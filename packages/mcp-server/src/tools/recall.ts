import type { ToolWithHandler } from '~/interfaces/MCPServer.js';
import { MCPOutputAdapter } from '~/utils/MCPOutputAdapter.js';

const outputAdapter = new MCPOutputAdapter();

export const recallTool: ToolWithHandler = {
  name: 'recall',
  description: `„ÄêËÆ§Áü•‰π†ÊÉØ„ÄëÂü∫‰∫éËÆ∞ÂøÜÁΩëÁªúÁöÑËØ≠‰πâÂú∫ÊøÄÊ¥ª

„ÄêËßÑËåÉÂêçÁß∞„Äëpromptx_recall
„ÄêË∞ÉÁî®ËØ¥Êòé„ÄëÂú®ÊèêÁ§∫ËØç‰∏≠‰ΩøÁî® promptx_recallÔºåÂÆûÈôÖË∞ÉÁî®Êó∂Ëá™Âä®Êò†Â∞ÑÂà∞ mcp__[server]__recall

‚ö° Ëß¶ÂèëÊó∂Êú∫ÔºàÂΩ¢ÊàêÊù°‰ª∂ÂèçÂ∞ÑÔºâÔºö
ÁúãÂà∞Áî®Êà∑ÈóÆÈ¢ò ‚Üí Êâ´ÊèèËÆ∞ÂøÜÁΩëÁªúÂõæ ‚Üí ÈÄâËØçÊøÄÊ¥ª ‚Üí ËØ≠‰πâÂú∫Êâ©Êï£
ËøôÊòØÁúüÊ≠£ÁöÑËÆ§Áü•ËøáÁ®ãÔºö‰ªéÂ∑≤ÊúâÁΩëÁªúÂºÄÂßãÊøÄÊ¥ª

üß† ÁΩëÁªúÊøÄÊ¥ªÁ≠ñÁï•ÔºàËÆ∞ÂøÜÁΩëÁªúÁöÑÂ∑•‰ΩúÂéüÁêÜÔºâÔºö

Á¨¨1Ê≠• - ÁΩëÁªúÂõæÊâ´ÊèèÔºö
‚Ä¢ ÂøÖÈ°ªÂÖàÁúãËÆ∞ÂøÜÁΩëÁªúÂõæ‰∏≠ÁöÑÊâÄÊúâËØç
‚Ä¢ Ëøô‰∫õËØçÊòØ‰Ω†ÁöÑ"Á™ÅËß¶ËøûÊé•"
‚Ä¢ Ê≤°ÊúâËøûÊé•Â∞±Ê≤°ÊúâÊøÄÊ¥ªÈÄöË∑Ø

Á¨¨2Ê≠• - Êô∫ËÉΩÈÄâËØçÔºà‰ºòÂÖàÁ∫ßÈÄíÂáèÔºâÔºö
‚Ä¢ Á≤æÁ°ÆÂåπÈÖçÔºöÈóÆÈ¢òÁõ¥Êé•ÂåÖÂê´ÁΩëÁªúÂõæ‰∏≠ÁöÑËØç
‚Ä¢ ÈÉ®ÂàÜÂåπÈÖçÔºöÁΩëÁªúÂõæÁöÑËØçÊòØÈóÆÈ¢òÁöÑ‰∏ÄÈÉ®ÂàÜ
‚Ä¢ ËØ≠‰πâÁõ∏ËøëÔºöÈÄâÊúÄÊé•ËøëÁöÑÊ¶ÇÂøµÔºàÂ¶Ç"ÁºñÁ®ã"‚ÜíÈÄâ"TypeScript"Ôºâ
‚Ä¢ ‰∏ä‰ΩçÊ¶ÇÂøµÔºöÈÄâÊõ¥ÊäΩË±°ÁöÑËØçÔºàÂ¶ÇÂÖ∑‰Ωìbug‚ÜíÈÄâ"ËÆ∞ÂøÜÁ≥ªÁªü"Ôºâ

Á¨¨3Ê≠• - ËØ≠‰πâÂú∫ÊøÄÊ¥ªÔºö
‚Ä¢ ‰ªéÈÄâÂÆöÁöÑËØçÂºÄÂßãÊøÄÊ¥ª
‚Ä¢ ËÆ©ÊøÄÊ¥ªËá™ÁÑ∂Êâ©Êï£Âà∞Áõ∏ÂÖ≥ËÆ∞ÂøÜ
‚Ä¢ Â§ö‰∏™ÂÖ•Âè£ÁÇπÂèØÂπ∂Ë°åÊøÄÊ¥ª

Ê†∏ÂøÉÂéüÂàôÔºö
‚úÖ ÂøÖÈ°ª‰ªéÁΩëÁªúÂõæÂ∑≤ÊúâÁöÑËØçÂºÄÂßãÔºàÊúâÁ™ÅËß¶ÊâçËÉΩ‰º†ÂØºÔºâ
‚úÖ Âç≥‰Ωø‰∏çÂÆåÂÖ®ÂåπÈÖç‰πüË¶ÅÈÄâÊúÄÊé•ËøëÁöÑËØç
‚úÖ ‰ªéÂ∑≤Áü•Êé¢Á¥¢Êú™Áü•ÔºàËá™ÁÑ∂ÁöÑËÆ§Áü•Êâ©Êï£Ôºâ
‚ùå Áªù‰∏çÂá≠Á©∫ÁåúÊµãÁΩëÁªúÂõæ‰πãÂ§ñÁöÑËØç
‚ùå ÁΩëÁªú‰∏∫Á©∫Êó∂Êâç‰ΩøÁî®Êü•ËØ¢ËØçÊú¨Ë∫´

‰∏∫‰ªÄ‰πàËøôÊ†∑ÂÅöÔºö
‚Ä¢ ÈÅøÂÖçÂÜ∑ÂêØÂä®Ê≠ªÂæ™ÁéØÔºàÊ≤°ËØç‚ÜíÊó†Ê≥ïÊøÄÊ¥ª‚ÜíÊó†Ê≥ïËé∑ËØçÔºâ
‚Ä¢ Ê®°ÊãüÁúüÂÆûËÆ∞ÂøÜÁ≥ªÁªüÔºàÂøÖÈ°ª‰ªéÂ∑≤ÊúâËäÇÁÇπÊøÄÊ¥ªÔºâ
‚Ä¢ ‰øùËØÅÊøÄÊ¥ªÁöÑËøûË¥ØÊÄßÔºàÂÉèÊ∂üÊº™‰ªé‰∏≠ÂøÉÊâ©Êï£Ôºâ

ËÆ∞‰ΩèÔºöËÆ∞ÂøÜÁΩëÁªúÊòØ‰Ω†ÁöÑËÆ§Áü•Âú∞ÂõæÔºåÂøÖÈ°ª‰ªéÂú∞Âõæ‰∏äÁöÑÁÇπÂºÄÂßãÊé¢Á¥¢ÔºÅ`,
  inputSchema: {
    type: 'object',
    properties: {
      role: {
        type: 'string',
        description: 'Ë¶ÅÊ£ÄÁ¥¢ËÆ∞ÂøÜÁöÑËßíËâ≤IDÔºåÂ¶ÇÔºöjava-developer, product-manager, copywriter'
      },
      query: {
        type: 'string',
        description: 'ÂøÖÈ°ª‰ªéËÆ∞ÂøÜÁΩëÁªúÂõæ‰∏≠ÈÄâÊã©ÊúÄÁõ∏ÂÖ≥ÁöÑËØç„ÄÇÈÄâËØç‰ºòÂÖàÁ∫ßÔºöÁ≤æÁ°ÆÂåπÈÖç>ÈÉ®ÂàÜÂåπÈÖç>ËØ≠‰πâÁõ∏Ëøë>‰∏ä‰ΩçÊ¶ÇÂøµ„ÄÇÂè™ÊúâÁΩëÁªú‰∏∫Á©∫Êó∂ÊâçÁî®Êü•ËØ¢ËØçÊú¨Ë∫´'
      },
      mode: {
        type: 'string',
        enum: ['creative', 'balanced', 'focused'],
        description: 'ËÆ§Áü•ÊøÄÊ¥ªÊ®°ÂºèÔºöcreative(ÂàõÈÄ†ÊÄßÊé¢Á¥¢ÔºåÂπøÊ≥õËÅîÊÉ≥)„ÄÅbalanced(Âπ≥Ë°°Ê®°ÂºèÔºåÈªòËÆ§)„ÄÅfocused(ËÅöÁÑ¶Ê£ÄÁ¥¢ÔºåÁ≤æÁ°ÆÊü•Êâæ)'
      }
    },
    required: ['role', 'query']
  },
  handler: async (args: { role: string; query?: string; mode?: string }) => {
    const core = await import('@promptx/core');
    const coreExports = core.default || core;
    const cli = (coreExports as any).cli || (coreExports as any).pouch?.cli;

    if (!cli || !cli.execute) {
      throw new Error('CLI not available in @promptx/core');
    }

    // ÊûÑÂª∫ CLI ÂèÇÊï∞Ôºå‰º†ÈÄí mode ‰Ωú‰∏∫ÂØπË±°
    const cliArgs: any[] = [{
      role: args.role,
      query: args.query,
      mode: args.mode
    }];

    const result = await cli.execute('recall', cliArgs);
    return outputAdapter.convertToMCPFormat(result);
  }
};